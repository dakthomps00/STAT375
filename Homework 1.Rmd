---
title: "Homework 1"
author: "Dakota Thompson"
date: "2/4/2021"
output: word_document
---

# Complete the following problems from Wickham and Grolemund:

```{r setup, include=FALSE}
library(nycflights13)
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE)
```

## Section 5.2.4, Exercise 1
### Find all flights that

```{r}
flights
```

#### Had an arrival delay of two or more hours

Arr_delay is in minutes, so 60 minutes per hour, then 2 hours would be 120 minutes. From there we have to have all of the delays that are greater than 2 hours and include the 2 hours.

```{r}
delay = filter(flights, arr_delay >= 120)
delay
```

#### Flew to Houston (IAH or HOU)

We got the destination airport of IAH or HOU.

```{r}
dest = filter(flights, dest == 'IAH' | dest == 'HOU')
dest
```

#### Were operated by United, American, or Delta

We got the carrier airline of UA (United) or AA (American) or DL (Delta).

```{r}
carrier1 = filter(flights, carrier == 'UA' | carrier == 'AA' | carrier == 'DL')
carrier1
```

#### Departed in summer (July, August, and September)

We got all the months of summer, which the question says is July-Sept. As such we just need the months between 7 and 9.

```{r}
summer = filter(flights, between(month, 7, 9))
summer
```

#### Arrived more than two hours late, but didnâ€™t leave late

We needed all the arr_delays that were more than 120 minutes late, however we also needed all the dep_delays to be less than one because we wanted 0 (left on time) and negative numbers (left early) as they didn't leave late. 

```{r}
deptimearrlate = filter(flights, arr_delay > 120 & dep_delay < 1)
deptimearrlate
```

#### Were delayed by at least an hour, but made up over 30 minutes in flight

We need the flights to be delayed by more than an hour in leaving, but also the ones who were delayed 30 minutes less than how they were delayed in departure to show they made that time back up.

```{r}
delaymadeback = filter(flights, arr_delay >= 120 & arr_delay <= dep_delay - 30)
delaymadeback
```

#### Departed between midnight and 6am (inclusive)

We need the times between midnight and 1 am separate from 1 to 6 because 2400 > 100 and 600. So we have to put all the times from midnight to 1 or all the times from 1 to 6. 

```{r}
midto6 = filter(flights, between(dep_time, 2400,2459) | between(dep_time, 100,600))
midto6
```

## Section 5.3.1, Exercise 3
### Sort flights to find the fastest (highest speed) flights.

I added a speed variable of distance over time. Then I arranged the data frame by speed in descending order.

```{r}
flightsspeed = mutate(flights, speed = distance/air_time)
highspeedtop = arrange(flightsspeed, desc(speed))
highspeedtop
```

## Section 5.4.1, Exercise 3
### What does the any_of() function do? 

It searches a data frame for any of the characters put into the function.

### Why might it be helpful in conjunction with this vector?
#### vars <- c("year", "month", "day", "dep_delay", "arr_delay")

It could make it easier to traverse a huge data frame for the flights that aren't performing as well (being on time) and when certain flights took place. It could also be used as a way to search flights within a period of time that were late, early, or on time. 

## Section 5.5.2, Exercise 2

Compare air_time with arr_time - dep_time. What do you expect to see? What do you see? What do you need to do to fix it?

```{r}
flightsarrdep = mutate(flights, arrmindep = arr_time-dep_time)
flightsarrdep = select(flightsarrdep, arrmindep, air_time)
flightsarrdep
```

I would expect to see them to be the same because the departure and arrival times would be the beginning and end of a flight. The air time and arrival - departure are different however. To fix this I would need to account for from where they left because of time zones. 

## Section 5.6.7, Exercises 4 and 5

### Look at the number of cancelled flights per day. Is there a pattern? 

```{r}
cancelledbyday <- 
  flights %>%
  mutate(cancelled = (is.na(arr_delay) | is.na(dep_delay))) %>%
  group_by(year, month, day) %>%
  summarise(
    numbercancelled = sum(cancelled),
    totalflights = n(),
  )
  
cancelledbyday
```

There seems to be more cancelled flights in the winter. There even seemed to be a major snow storm in early February. 

### Is the proportion of cancelled flights related to the average delay?

```{r}
cancelledvdelay <- 
  flights %>%
  mutate(cancelled = (is.na(arr_delay) | is.na(dep_delay))) %>%
  group_by(year, month, day) %>%
  summarise(
    cancelledmean = mean(cancelled),
    departuremean = mean(dep_delay, na.rm = TRUE),
    arrivalmean = mean(arr_delay, na.rm = TRUE)
  ) %>%
  ungroup()

cancelledvdelay
```

There seems to be higher average cancellations on days where there are higher average delays, for both departure and arrival.

### Which carrier has the worst delays? 

### Challenge: can you disentangle the effects of bad airports vs. bad carriers? Why/why not? (Hint: think about flights %>% group_by(carrier, dest) %>% summarise(n()))

```{r}
cancelled_and_delays <- 
  flights %>%
  mutate(cancelled = (is.na(arr_delay) | is.na(dep_delay))) %>%
  group_by(year, month, day) %>%
  summarise(
    cancelled_prop = mean(cancelled),
    avg_dep_delay = mean(dep_delay, na.rm = TRUE),
    avg_arr_delay = mean(arr_delay, na.rm = TRUE)
  ) %>%
  ungroup()
```

## Section 5.7.1, Exercise 3

What time of day should you fly if you want to avoid delays as much as possible? 

```{r}
flights %>% 
  group_by(dep_time) %>%
  filter(rank(desc(arr_delay)) < 10)
```

You should fly in the early morning!